# 快速参考卡片 - 比赛计分规则

## 赛道元素
```
起点A (20cm白线) → B点×4 (20cm白线) → C干扰线×3 (10cm) → 终点D (20cm白线)
完整顺序：A → B1 → B2 → B3 → C1 → C2 → C3 → B4 → D
```

## 时间计算规则

### ❌ 惩罚项（增加时间）
| 错误 | 惩罚时间 | 对应功能 |
|------|---------|----------|
| 蜂鸣器未响 | +5秒/点位 | `Beep_Times()` |
| 蜂鸣器次数错误 | +5秒/点位 | `Check_Wide_Line()` |
| 终点未停稳 | +10秒 | `STATE_FINISHED` |
| 无按键启动 | +5秒 | `KEY_IsPressed()` |
| 冲出赛道 | 可重启，总时限3分钟 | 巡线算法 |

### ✅ 加分项（减少时间）
| 功能 | 减少时间 | 对应功能 |
|------|---------|----------|
| OLED显示时间(精确到0.01秒) | -20秒 | `Display_Time()` |
| RGB彩灯 | -5秒 | `RGB_Running_Effect()` |

## 蜂鸣器响应规则
| 点位 | 位置 | 响应次数 |
|------|-----|---------|
| B1 | 第2个宽线 | 1次 |
| B2 | 第3个宽线 | 2次 |
| B3 | 第4个宽线 | 3次 |
| B4 | 第8个宽线 | 4次 |

## 代码关键参数速查

### 在 main.c 中
```c
// 宽线检测阈值（8路传感器中检测到白线的最少数量）
if(white_count >= 6)  // 第135行

// 蜂鸣器响应时长和间隔
delay_ms(150);  // 响150ms，第116行
delay_ms(150);  // 间隔150ms，第119行

// 终点判断（检测到第几个宽线）
if(beep_point_count >= 5)  // 第139行
```

### 在 app_irtracking_eight.c 中
```c
#define IRR_SPEED 200  // 巡线速度（第13行）
#define TURN_SPEED 300 // 转弯速度（第14行）

#define IRTrack_Trun_KP (200)   // PID比例系数（第5行）
#define IRTrack_Trun_KI (0.02)  // PID积分系数（第6行）
#define IRTrack_Trun_KD (0)     // PID微分系数（第7行）
```

### 在 bsp_timer.c 中
```c
run_time_ms += 20;  // 每个中断周期累加20ms（第25行）
```

## 理论最佳成绩计算

假设实际跑完赛道需要 X 秒：

**完美执行所有功能：**
- 实际时间：X 秒
- OLED时间显示：-20秒
- RGB灯效：-5秒
- **最终成绩：X - 25 秒**

**示例：**
- 如果裸跑时间是 30 秒
- 完美执行：30 - 25 = **5 秒** ✨

## 调试技巧

### 串口输出关键信息
```c
printf("State:%d Time:%d.%02d Beep:%d\n", 
    system_state, 
    run_time_ms/1000, 
    (run_time_ms%1000)/10,
    beep_point_count);
```

### OLED显示调试信息
```c
OLED_ShowString(0, 0, "Time:", 8, 1);
OLED_ShowNum(40, 0, seconds, 3, 8, 1);
OLED_ShowString(0, 16, "Beep:", 8, 1);
OLED_ShowNum(40, 16, beep_point_count, 1, 8, 1);
```

## 现场应急方案

### 传感器不准
```c
// 调整宽线检测阈值
if(white_count >= 6)  // 改为 5 或 7
```

### 蜂鸣器不响
```c
// 增加响应时长
delay_ms(150);  // 改为 200 或 250
```

### 速度太快/太慢
```c
#define IRR_SPEED 200  // 调整这个值
```

### 转弯不顺畅
```c
#define TURN_SPEED 300  // 增加转弯速度
#define IRTrack_Trun_KP (200)  // 增加比例系数
```

## 比赛流程清单

### 准备阶段
1. ⚡ 检查电池电量
2. 🔧 测试所有传感器
3. 📱 验证OLED显示
4. 🔊 测试蜂鸣器
5. 🎮 测试按键

### 起跑阶段
1. 将小车尾部对准起点红线
2. 等待OLED显示 "Press KEY Start"
3. 按下按键启动
4. 听到1声提示音后松开

### 运行阶段
- 观察OLED时间显示
- 注意每个B点的蜂鸣器响应
- 确认小车能通过干扰线区域

### 终点阶段
- 听到2声提示音
- 确认小车已停稳
- 查看OLED最终时间

## 成绩预测表

| 裸跑时间 | 完美执行 | 漏1个蜂鸣器 | 漏时间显示 | 终点未停 |
|---------|---------|------------|-----------|---------|
| 20秒 | -5秒 ✨ | 0秒 | +15秒 | +5秒 |
| 30秒 | 5秒 ✨ | 10秒 | 35秒 | 15秒 |
| 40秒 | 15秒 ✨ | 20秒 | 45秒 | 25秒 |
| 50秒 | 25秒 ✨ | 30秒 | 55秒 | 35秒 |

**✨ = 理论最佳成绩**

---
**记住：稳定性 > 速度！确保每个功能都可靠工作比跑得快更重要！**
